if(!RedactorPlugins){var RedactorPlugins={}}(function(a){RedactorPlugins.table=function(){return{getTemplate:function(){return String()+'<section id="redactor-modal-table-insert"><label>'+this.lang.get("rows")+'</label><input type="text" size="5" value="2" id="redactor-table-rows" /><label>'+this.lang.get("columns")+'</label><input type="text" size="5" value="3" id="redactor-table-columns" /></section>'},init:function(){var c={};c.insert_table={title:this.lang.get("insert_table"),func:this.table.show};c.insert_row_above={title:this.lang.get("insert_row_above"),func:this.table.addRowAbove};c.insert_row_below={title:this.lang.get("insert_row_below"),func:this.table.addRowBelow};c.insert_column_left={title:this.lang.get("insert_column_left"),func:this.table.addColumnLeft};c.insert_column_right={title:this.lang.get("insert_column_right"),func:this.table.addColumnRight};c.add_head={title:this.lang.get("add_head"),func:this.table.addHead};c.delete_head={title:this.lang.get("delete_head"),func:this.table.deleteHead};c.delete_column={title:this.lang.get("delete_column"),func:this.table.deleteColumn};c.delete_row={title:this.lang.get("delete_row"),func:this.table.deleteRow};c.delete_table={title:this.lang.get("delete_table"),func:this.table.deleteTable};this.observe.addButton("td","table");this.observe.addButton("th","table");var b=this.button.addBefore("link","table",this.lang.get("table"));this.button.addDropdown(b,c)},show:function(){this.modal.addTemplate("table",this.table.getTemplate());this.modal.load("table",this.lang.get("insert_table"),300);this.modal.createCancelButton();var b=this.modal.createActionButton(this.lang.get("insert"));b.on("click",this.table.insert);this.selection.save();this.modal.show();a("#redactor-table-rows").focus()},insert:function(){this.placeholder.remove();this.clean.cleanEmptyParagraph();var o=a("#redactor-table-rows").val(),d=a("#redactor-table-columns").val(),b=a("<div>"),c=Math.floor(Math.random()*99999),m=a('<table id="table'+c+'"><tbody></tbody></table>'),f,j,k,l;for(f=0;f<o;f++){j=a("<tr>");for(k=0;k<d;k++){l=a("<td>"+this.opts.invisibleSpace+"</td>");if(f===0&&k===0){l.append(this.selection.getMarker())}a(j).append(l)}m.append(j)}b.append(m);var g=b.html();this.modal.close();this.selection.restore();if(this.table.getTable()){return}this.buffer.set();var h=this.selection.getBlock()||this.selection.getCurrent();if(h&&h.tagName!="BODY"){if(h.tagName=="LI"){h=a(h).closest("ul, ol")}a(h).after(g)}else{this.insert.html(g,false)}this.selection.restore();var n=this.$editor.find("#table"+c);if(!this.opts.linebreaks&&(this.utils.browser("mozilla")||this.utils.browser("msie"))){var e=n.next();if(e.length===0){n.after(this.opts.emptyHtml)}}this.observe.buttons();n.find("span.redactor-selection-marker").remove();n.removeAttr("id");this.code.sync();this.core.setCallback("insertedTable",n)},getTable:function(){var b=a(this.selection.getParent()).closest("table");if(!this.utils.isRedactorParent(b)){return false}if(b.size()===0){return false}return b},restoreAfterDelete:function(b){this.selection.restore();b.find("span.redactor-selection-marker").remove();this.code.sync()},deleteTable:function(){var c=this.table.getTable();if(!c){return}this.buffer.set();var b=c.next();if(!this.opts.linebreaks&&b.length!==0){this.caret.setStart(b)}else{this.caret.setAfter(c)}c.remove();this.code.sync()},deleteRow:function(){var b=this.table.getTable();if(!b){return}var d=a(this.selection.getCurrent());this.buffer.set();var f=d.closest("tr");var c=f.prev().length?f.prev():f.next();if(c.length){var e=c.children("td, th").first();if(e.length){e.prepend(this.selection.getMarker())}}f.remove();this.table.restoreAfterDelete(b)},deleteColumn:function(){var d=this.table.getTable();if(!d){return}this.buffer.set();var e=a(this.selection.getCurrent());var b=e.closest("td, th");var c=b[0].cellIndex;d.find("tr").each(a.proxy(function(g,h){var f=a(h);var j=c-1<0?c+1:c-1;if(g===0){f.find("td, th").eq(j).prepend(this.selection.getMarker())}f.find("td, th").eq(c).remove()},this));this.table.restoreAfterDelete(d)},addHead:function(){var b=this.table.getTable();if(!b){return}this.buffer.set();if(b.find("thead").size()!==0){this.table.deleteHead();return}var c=b.find("tr").first().clone();c.find("td").replaceWith(a.proxy(function(){return a("<th>").html(this.opts.invisibleSpace)},this));$thead=a("<thead></thead>").append(c);b.prepend($thead);this.code.sync()},deleteHead:function(){var b=this.table.getTable();if(!b){return}var c=b.find("thead");if(c.size()===0){return}this.buffer.set();c.remove();this.code.sync()},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(d){var b=this.table.getTable();if(!b){return}this.buffer.set();var c=a(this.selection.getCurrent());var e=c.closest("tr");var f=e.clone();f.find("th").replaceWith(function(){var g=a("<td>");g[0].attributes=this.attributes;return g.append(a(this).contents())});f.find("td").html(this.opts.invisibleSpace);if(d=="after"){e.after(f)}else{e.before(f)}this.code.sync()},addColumn:function(e){var d=this.table.getTable();if(!d){return}var c=0;var f=a(this.selection.getCurrent());this.buffer.set();var g=f.closest("tr");var b=f.closest("td, th");g.find("td, th").each(a.proxy(function(h,j){if(a(j)[0]===b[0]){c=h}},this));d.find("tr").each(a.proxy(function(h,k){var j=a(k).find("td, th").eq(c);var l=j.clone();l.html(this.opts.invisibleSpace);if(e=="after"){j.after(l)}else{j.before(l)}},this));this.code.sync()}}}})(jQuery);